const translations = {
  en: {
      universal: {
        button: {
          view_page: '<i class="fa-solid fa-hand-pointer"></i> View Page',
          more_pages: '<i class="fa-solid fa-list-ul"></i> More Pages',
          more_wiki: '<i class="fa-solid fa-book"></i> More Wiki',
          read_wiki: '<i class="fa-solid fa-book-open-reader"></i> Read Wiki',
          read: '<i class="fa-solid fa-book-open-reader"></i> Read',
          view_more: '<i class="fa-solid fa-hand-pointer"></i> View More',
          view_old_news: '<i class="fa-solid fa-hand-pointer"></i> View Old News',
          back_to_home: '<i class="fa-solid fa-arrow-left"></i> Back to Home',
        },
        information: '<i class="fa-solid fa-circle-info"></i> Information',
        wiki: '<i class="fa-solid fa-book"></i> Wiki',
        projects: '<i class="fa-solid fa-list-ul"></i> Projects',
        blog: '<i class="fa-solid fa-newspaper"></i> Blog',
        devblog: 'Devblog',
        gallery: '<i class="fa-solid fa-camera"></i> Gallery',
        links: '<i class="fa-solid fa-share"></i> Links',
        home: '<i class="fa-solid fa-house"></i> Home',
        time_zone: 'Time zone is UTC+3'
      },
      index: {
        about_me: 'About me',
        bio: "Hi, my nickname is Donne431, I just a guy, who love made a modifications for games. I'm 17 years old, and I'm from Crimea (demi-island washed by the Black and Azov Sea), Russia. I also like to create almost any content for Minecraft, that is: mods, maps, resource packs, servers.",
        partners: 'Partners',
        partners_info: 'With regard to the partnership, write to the Discord personal account (@Donne431).',
        support: 'Support me by donating',
        status: 'Status',
        status_text: 'You can find out my nearest plans on page "<i class="fa-solid fa-road"></i> Roadmap"'
      },
      roadmap: {
        roadmap: '<i class="fa-solid fa-road"></i> Roadmap',
        just_nothing: 'Just nothing...',
        coming_soon: 'Coming soon...',
        complementing: 'Complementing...',
        2025: {
          february: '<i class="fa-solid fa-calendar-days"></i> February 2025',
          february_1: 'Launching a website: launching this website',
          february_2: 'Update addons for Create: just updated logo',
          february_3: 'Update <img src="../img/projects/ice_and_fire_delight/logo_cutted.png" class="icon-x1_5"> Ice and Fire Delight - 0.2.2: New configs, bugfixes and new advancements',
          february_4_1: '<s>Release new mod: Create: Lights up</s>',
          february_4_2: 'So far, development has been frozen',
          march: '<i class="fa-solid fa-calendar-days"></i> March 2025',
          march_1: 'Update Potion of Flying - 1.0.2: Rewrited Flying effect code',
          march_2: 'Create wiki for IaFD: just mini wiki for the mod',
          april: '<i class="fa-solid fa-calendar-days"></i> April 2025',
          april_1: 'Release new mod: Just FPS',
          april_2: 'Update <img src="../img/projects/ice_and_fire_delight/logo_cutted.png" class="icon-x1_5"> Ice and Fire Delight - 0.2.3 (Major update): New items, advancements, bugfixes, remaked textures and more.',
          may: '<i class="fa-solid fa-calendar-days"></i> May 2025',
          may_1: 'Release new mod: Death Coordinate',
          may_2: 'Release new resourcepack: AE2 Guide - Russian Localization',
          may_3_1: '<s>Release new datapack: Create: Lights up</s>',
          may_3_2: 'So far, development has been frozen',
          june: '<i class="fa-solid fa-calendar-days"></i> June 2025',
          july: '<i class="fa-solid fa-calendar-days"></i> July 2025',
          july_1: 'Update for the <img src="../img/projects/ice_and_fire_delight/logo_cutted.png" class="icon-x1_5"> Ice and Fire Delight wiki',
          august: '<i class="fa-solid fa-calendar-days"></i> August 2025',
          august_1: 'Update for the website (Translation system + minor changes)',
          august_2: 'Update <img src="../img/projects/ice_and_fire_delight/logo_cutted.png" class="icon-x1_5"> Ice and Fire Delight - 0.2.4: New item, bugfixes and minor changes.',
          september: '<i class="fa-solid fa-calendar-days"></i> September 2025',
          october: '<i class="fa-solid fa-calendar-days"></i> October 2025',
          november: '<i class="fa-solid fa-calendar-days"></i> November 2025',
          december: '<i class="fa-solid fa-calendar-days"></i> December 2025'
        },
        2026: {
          january: '<i class="fa-solid fa-calendar-days"></i> January 2026',
          january_1: 'Update <img src="../img/projects/national_anthems/logo.png" class="icon-x1_5"> National anthems - 1.5.5',
          january_2: 'Update <img src="../img/projects/classic_musical_discs/logo.png" class="icon-x1_5"> Classic musical discs - 1.5.1',
          february: '<i class="fa-solid fa-calendar-days"></i> February 2026',
          february_1: 'Update <img src="../img/projects/classic_musical_discs/logo.png" class="icon-x1_5"> Classic musical discs - 1.5.2'
        }
      },
      wiki: {
        index: {

        },
        iafd: {
          index: {

          },
          drinks: {

          },
          foods: {

          },
          effects: {

          },
          items: {

          },
          tags: {

          },
          tools: {

          }
        }
      },
      projects: {
        iafd: {
          index: {

          },
          changelog: {

          },
          compatible_mods: {

          },
          download: {

          },
          incompatible_mods: {

          },
          spoilers: {

          }
        },
        bamboo_spikes: {

        },
        create_curios_backtank: {

        },
        dcigse: {

        },
        dmd: {

        },
        forbidden_axe_3d: {

        },
        htiap: {

        },
        lrofc: {

        },
        potion_of_flying: {

        }
      },
      blog: {

      },
      devblog: {
        iafd: {
          1: {

          }
        } 
      }
    },
  ru: {
      universal: {
        button: {
          view_page: '<i class="fa-solid fa-hand-pointer"></i> <strong>Посмотреть Страницу</strong>',
          more_pages: '<i class="fa-solid fa-list-ul"></i> <strong>Больше Страниц</strong>',
          more_wiki: '<i class="fa-solid fa-book"></i> <strong>Больше Вики</strong>',
          read_wiki: '<i class="fa-solid fa-book-open-reader"></i> <strong>Прочитать Вики</strong>',
          read: '<i class="fa-solid fa-book-open-reader"></i> <strong>Читать</strong>',
          view_more: '<i class="fa-solid fa-hand-pointer"></i> <strong>Посмотреть Больше</strong>',
          view_old_news: '<i class="fa-solid fa-hand-pointer"></i> <strong>Посмотреть Старые Новости</strong>',
          back_to_home: '<i class="fa-solid fa-arrow-left"></i> <strong>Обратно на Главную страницу</strong>',
        },
        information: '<i class="fa-solid fa-circle-info"></i> <strong>Информация</strong>',
        wiki: '<i class="fa-solid fa-book"></i> <strong>Вики</strong>',
        projects: '<i class="fa-solid fa-list-ul"></i> <strong>Проекты</strong>',
        blog: '<i class="fa-solid fa-newspaper"></i> <strong>Блог</strong>',
        devblog: '<strong>Дневник разработки</strong>',
        gallery: '<i class="fa-solid fa-camera"></i> <strong>Галерея</strong>',
        links: '<i class="fa-solid fa-share"></i> <strong>Ссылки</strong>',
        home: '<i class="fa-solid fa-house"></i> <strong>Главная страница</strong>',
        time_zone: '<b>Часовой пояс - МСК или</b> UTC+3'
      },
      index: {
        about_me: 'Обо мне',
        bio: 'Привет, мой никнейм - Donne431, я просто чел, который любит делать модификации для игр. Мне 17 лет, я с Крыма (полуостров, омываемый Чёрным и Азовским морем), Россия. Я также люблю создавать почти любой контент для Minecraft, к примеру: моды, карты, ресурспаки, сервера.',
        partners: 'Партнёры',
        partners_info: 'Если у вас есть предложение сотрудничать, тогда напишите мне на мой персональный дискорд аккаунт (@Donne431).',
        support: 'Поддержите меня донатом',
        status: 'Статус',
        status_text: 'Вы можете найти мои ближайшие планы на странице "<i class="fa-solid fa-road"></i> Дорожная карта"'
      },
      roadmap: {
        roadmap: '<i class="fa-solid fa-road"></i> <strong>Дорожная карта</strong>',
        just_nothing: 'Пустота...',
        coming_soon: 'Скоро...',
        complementing: 'Дополняется...',
        2025: {
          february: '<i class="fa-solid fa-calendar-days"></i> Февраль 2025',
          february_1: 'Запуск веб сайта: запуск этого веб сайта',
          february_2: 'Обновление аддонов для Create: просто обновлённые лого',
          february_3: 'Обновление <img src="../img/projects/ice_and_fire_delight/logo_cutted.png" class="icon-x1_5"> Ice and Fire Delight - 0.2.2: Новые конфиги, достижения и исправление багов',
          february_4_1: '<s>Релиз нового мода: Create: Lights up</s>',
          february_4_2: 'Разработка мода была заморожена',
          march: '<i class="fa-solid fa-calendar-days"></i> Март 2025',
          march_1: 'Обновление Potion of Flying - 1.0.2: Переписан код эффекта полёта',
          march_2: 'Cоздать вики для IaFD: простое мини вики для мода',
          april: '<i class="fa-solid fa-calendar-days"></i> Апрель 2025',
          april_1: 'Релиз нового мода: Just FPS',
          april_2: 'Обновление <img src="../img/projects/ice_and_fire_delight/logo_cutted.png" class="icon-x1_5"> Ice and Fire Delight - 0.2.3 (Крупное обновление): Новые предметы, достижения, исправление багов, переделанные текстуры и многое другое</a>',
          may: '<i class="fa-solid fa-calendar-days"></i> Май 2025',
          may_1: 'Релиз нового мода: Death Coordinate',
          may_2: 'Релиз нового ресурспака: AE2 Guide - Russian Localization',
          may_3_1: '<s>Релиз нового датапака: Create: Lights up</s>',
          may_3_2: 'Разработка датапака была заморожена',
          june: '<i class="fa-solid fa-calendar-days"></i> Июнь 2025',
          july: '<i class="fa-solid fa-calendar-days"></i> Июль 2025',
          july_1: 'Обновление вики <img src="../img/projects/ice_and_fire_delight/logo_cutted.png" class="icon-x1_5"> Ice and Fire Delight',
          august: '<i class="fa-solid fa-calendar-days"></i> Август 2025',
          august_1: 'Обновление сайта (Система перевода + мелкие изменения)',
          august_2: 'Обновление <img src="../img/projects/ice_and_fire_delight/logo_cutted.png" class="icon-x1_5"> Ice and Fire Delight - 0.2.4: Новый предмет, исправление багов и мелкие изменения.',
          september: '<i class="fa-solid fa-calendar-days"></i> Сентябрь 2025',
          october: '<i class="fa-solid fa-calendar-days"></i> Октябрь 2025',
          november: '<i class="fa-solid fa-calendar-days"></i> Ноябрь 2025',
          december: '<i class="fa-solid fa-calendar-days"></i> Декабрь 2025'
        },
        2026: {
          january: '<i class="fa-solid fa-calendar-days"></i> Январь 2026',
          january_1: 'Обновление <img src="../img/projects/national_anthems/logo.png" class="icon-x1_5"> National anthems - 1.5.5',
          january_2: 'Обновление <img src="../img/projects/classic_musical_discs/logo.png" class="icon-x1_5"> Classic musical discs - 1.5.1',
          february: '<i class="fa-solid fa-calendar-days"></i> Февраль 2026',
          february_1: 'Обновление <img src="../img/projects/classic_musical_discs/logo.png" class="icon-x1_5"> Classic musical discs - 1.5.2'
        }
      },
      wiki: {
        index: {

        },
        iafd: {
          index: {

          },
          drinks: {

          },
          foods: {

          },
          effects: {

          },
          items: {

          },
          tags: {

          },
          tools: {

          }
        }
      },
      projects: {
        iafd: {
          index: {

          },
          changelog: {

          },
          compatible_mods: {

          },
          download: {

          },
          incompatible_mods: {

          },
          spoilers: {

          }
        },
        bamboo_spikes: {

        },
        create_curios_backtank: {

        },
        dcigse: {

        },
        dmd: {

        },
        forbidden_axe_3d: {

        },
        htiap: {

        },
        lrofc: {

        },
        potion_of_flying: {
          
        }
      },
      blog: {

      },
      devblog: {
        iafd: {
          1: {

          }
        } 
      }
    }
};

// Получаем текущий язык из localStorage или по умолчанию 'en'
let language = localStorage.getItem('language') || 'en';

// Функция для получения значения по пути (например, index.greeting)
function getTranslation(obj, keyPath) {
  return keyPath.split('.').reduce((current, key) => {
    return current && current[key] !== undefined ? current[key] : null;
  }, obj);
}

// Функция обновления переводов
function updateTranslations() {
  const t = translations[language];
  console.log(`Обновление переводов для языка: ${language}`);
  
  // Обновляем текст элементов с data-translate-key
  const translatableElements = document.querySelectorAll('[data-translate-key]');
  console.log(`Найдено элементов с data-translate-key: ${translatableElements.length}`);
  translatableElements.forEach(element => {
    const keyPath = element.getAttribute('data-translate-key');
    if (!keyPath) return;
    const value = getTranslation(t, keyPath);
    if (value) {
      if (value.includes('<')) {
        element.innerHTML = value; // поддержка HTML
      } else {
        element.textContent = value; // обычный текст
      }
    } else {
      console.warn(`Перевод для пути "${keyPath}" не найден на языке "${language}"`);
    }
  });

  // Обновляем атрибуты с data-translate-attr
  const attrElements = document.querySelectorAll('[data-translate-attr]');
  console.log(`Найдено элементов с data-translate-attr: ${attrElements.length}`);
  attrElements.forEach(element => {
    const attrString = element.getAttribute('data-translate-attr');
    if (!attrString) return;
    const [attrName, keyPath] = attrString.split(':');
    if (!attrName || !keyPath) return;
    const value = getTranslation(t, keyPath);
    if (value) {
      element.setAttribute(attrName, value);
    } else {
      console.warn(`Перевод атрибута для пути "${keyPath}" не найден на языке "${language}"`);
    }
  });
  
  // Обновляем текст кнопки переключения
  const toggleButton = document.getElementById('toggle-language');
  if (toggleButton) {
    toggleButton.textContent = language === 'en' ? 'Перейти на русский' : 'Switch to English';
  } else {
    console.error('Элемент с ID "toggle-language" не найден в DOM');
  }
}

// Функция переключения языка
function toggleLanguage() {
  language = language === 'en' ? 'ru' : 'en';
  localStorage.setItem('language', language);
  console.log(`Язык переключён на: ${language}`);
  updateTranslations();
}

// Наблюдатель за изменениями в #target (для динамического рендеринга Handlebars)
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM загружен, запускаем наблюдатель за #target');
  const targetNode = document.getElementById('target');
  if (!targetNode) {
    console.error('Элемент #target не найден в DOM');
    return;
  }

  // MutationObserver для отслеживания вставки содержимого в #target
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.addedNodes.length > 0) {
        console.log('Содержимое вставлено в #target, обновляем переводы и кнопку');
        updateTranslations();
        const toggleButton = document.getElementById('toggle-language');
        if (toggleButton) {
          toggleButton.addEventListener('click', toggleLanguage);
          console.log('Обработчик события "click" добавлен для кнопки toggle-language');
        } else {
          console.error('После рендеринга кнопка "toggle-language" всё ещё не найдена');
        }
        // Отключаем observer после первого изменения, чтобы не вызывать повторно
        observer.disconnect();
      }
    });
  });

  // Наблюдаем за изменениями в #target
  observer.observe(targetNode, { childList: true, subtree: true });
});